rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /documents/{documentId} {
      // Allow any authenticated user to read documents.
      // This is necessary for students, staff, and admins to access relevant files.
      // Your app's client-side logic should handle filtering to ensure users only
      // see documents they are permitted to see (e.g., their own class's results).
      allow read: if request.auth != null;

      // Allow write (create, update, delete) operations only for users
      // who have an 'admin' custom claim.
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // A catch-all rule to deny access to any other collections by default.
    match /{path=**} {
      allow read, write: if false;
    }
  }
}